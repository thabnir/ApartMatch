<!DOCTYPE html>
<html lang="en">
<head>
    <link
            rel="stylesheet"
            type="text/css"
            href="{{ url_for('static',filename='/index.css') }}"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <div class="mx-auto" style="width: 650px"><title>ApartMatch</title></div>
    <link
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
            rel="stylesheet"
    />
</head>

<body>
{% block content %}
    <h1>ApartMatch</h1>

    <div class="container mt-5" style="align-content: center">
        <div class="card" style="align-self: center">
            <div class="image-carousel">
                <!-- Image Carousel Here -->
            </div>
{#            <img src="https://cdn.realtor.ca/listings/TS638316759975800000/reb5/highres/9/19275679_1.jpg" class="w3-round" alt="filler">#}

            <div class="card-body">
                <h5 class="card-title" id="card-title">${{ data[0]['price'] }} </h5>
                <p class="card-text" id="location">Location: {{ data[0]['address'] }}</p>
                <p class="card-text" id="size">Size: {{ data[0]['size'] }}</p>
                <p class="card-text" id="type">Type: {{ data[0]['type'] }}</p>
                <p class="card-text" id="realtor">Realtor: {{ data[0]['agent'] }}</p>
                <p class="card-text" id="realtor-phone">{{ data[0]['agentPhone'] }}</p>
                <p class="card-text" id ="description">{{ data[0]['description'] }}</p>

                <div class="carousel-controls">
                    <button class="btn btn-primary prev-button">Previous Image</button>
                    <button class="btn btn-primary next-button">Next Image</button>
                </div>

                <button class="btn btn-success like-button">Like</button>
                <button class="btn btn-danger dislike-button">Dislike</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let currentCardIndex = 0;
            let currentImageIndex = 0;
            const apartments = {{ data | tojson | safe }};
            const card = document.querySelector(".card");
            const imageCarousel = document.querySelector(".image-carousel");
            const likeButton = document.querySelector(".like-button");
            const dislikeButton = document.querySelector(".dislike-button");
            const prevButton = document.querySelector(".prev-button");
            const nextButton = document.querySelector(".next-button");

            function showImages(index) {
                const apartment = apartments[index];
                const imageHtml = apartment["photo_list"]
                    .map((imageUrl, i) => `
                <img
                    src="${imageUrl}"
                    class="carousel-image ${i === 0 ? 'active' : ''}"
                    alt="Apartment Image"
                />
            `).join('');
                imageCarousel.innerHTML = imageHtml;
                currentImageIndex = 0; // Reset image index to 0 when showing a new card
            }

            function updateElementById(id, textContent) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = textContent;
                }
            }

            function showNextCard() {
                currentCardIndex++;
                if (currentCardIndex < apartments.length) {
                    const apartment = apartments[currentCardIndex];
                    updateElementById("card-title", `$${apartment["price"]}`);
                    updateElementById("location", `Location: ${apartment["address"]}`);
                    updateElementById("size", `Size: ${apartment["size"]}`);
                    updateElementById("type", `Type: ${apartment["type"]}`);
                    updateElementById("realtor", `Realtor: ${apartment["agent"]}`);
                    updateElementById("realtor-phone", `${apartment["agentPhone"]}`);
                    updateElementById("description", `${apartment["description"]}`);
                    showImages(currentCardIndex);
                } else {
                    card.style.display = "none"; // No more cards to show
                }
            }

            function showNextImage() {
                const images = imageCarousel.querySelectorAll(".carousel-image");
                const currentImage = imageCarousel.querySelector(".carousel-image.active");
                const currentIndex = Array.from(images).indexOf(currentImage);

                if (currentIndex < images.length - 1) {
                    currentImage.classList.remove("active");
                    images[currentIndex + 1].classList.add("active");
                    currentImageIndex++;
                }
            }

            function showPreviousImage() {
                const images = imageCarousel.querySelectorAll(".carousel-image");
                const currentImage = imageCarousel.querySelector(".carousel-image.active");
                const currentIndex = Array.from(images).indexOf(currentImage);

                if (currentIndex > 0) {
                    currentImage.classList.remove("active");
                    images[currentIndex - 1].classList.add("active");
                    currentImageIndex--;
                }
            }

            likeButton.addEventListener("click", function() {
                showNextCard();
                showNextImage();
            });

            dislikeButton.addEventListener("click", function() {
                showNextCard();
                showNextImage();
            });

            prevButton.addEventListener("click", function() {
                showPreviousImage();
            });

            nextButton.addEventListener("click", function() {
                showNextImage();
            });

            showImages(currentCardIndex); // Initialize with the first set of images
        });
    </script>

    <style>
        .carousel-image {
            display: none;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            height: auto;
        }

        .carousel-image.active {
            display: block;
        }

         .image-carousel {
             display: flex;
             justify-content: center;
             align-items: center;
             height: 300px; /* Adjust the height as needed */
             position: relative;
         }

        .carousel-image.active {
            display: block;
        }



    </style>
{% endblock %}
</body>
